<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>404 - AI Guided Recovery</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Open+Sans:wght@800&family=Roboto:wght@100;300;700&display=swap');

        /* Modern Reset & CSS Variables */
        *, *:after, *:before {
            box-sizing: border-box;
            transform-style: preserve-3d;
        }

        :root {
            --shadow: hsl(0 0% 0% / 0.9);
            --bg: hsl(0 0% 12%);
            --header: hsl(0 0% 25%);
            --lit-header: hsl(0 0% 100%);
            --speed: 3s;
            --ease: cubic-bezier(0.4, 0, 0.2, 1);
        }

        @property --swing-x {
            initial-value: 0;
            inherits: false;
            syntax: '<integer>';
        }
        @property --swing-y {
            initial-value: 0;
            inherits: false;
            syntax: '<integer>';
        }

        body {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            overflow: hidden;
            background: var(--bg);
            font-family: 'Roboto', sans-serif;
            perspective: 1200px;
            color: white;
        }

        body::before {
            --size: 40px;
            --line: rgba(255, 255, 255, 0.05);
            content: '';
            height: 100vh;
            width: 100vw;
            position: fixed;
            background: 
                linear-gradient(90deg, var(--line) 1px, transparent 1px var(--size)) 50% 50% / var(--size) var(--size),
                linear-gradient(var(--line) 1px, transparent 1px var(--size)) 50% 50% / var(--size) var(--size);
            mask: radial-gradient(circle at center, white, transparent 80%);
            top: 0;
            z-index: -1;
        }

        h1 {
            animation: swing var(--speed) infinite alternate var(--ease);
            font-size: clamp(8rem, 30vmin, 20rem);
            font-family: 'Open Sans', sans-serif;
            margin: 0;
            letter-spacing: -0.5rem;
            line-height: 1;
            position: relative;
            z-index: 2;
            --x: calc(50% + (var(--swing-x) * 0.5) * 1%);
            background: radial-gradient(circle at var(--x) 50%, var(--lit-header), var(--header) 50%);
            -webkit-background-clip: text;
            color: transparent;
        }

        h1 span {
            animation: swing var(--speed) infinite alternate var(--ease);
            position: absolute;
            inset: 0;
            color: var(--shadow);
            filter: blur(4vmin);
            transform: 
                translate3d(
                    calc((var(--swing-x) * -0.1) * 1%),
                    calc(15% + (var(--swing-y) * 0.05) * 1%),
                    -10vmin
                ) scale(1.1);
            z-index: -1;
        }

        .cloak__wrapper {
            position: fixed;
            inset: 0;
            overflow: hidden;
            pointer-events: none;
            z-index: 5;
        }

        .cloak__container {
            height: 250vmax;
            width: 250vmax;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .cloak {
            animation: swing var(--speed) infinite alternate-reverse var(--ease);
            height: 100%;
            width: 100%;
            background: radial-gradient(
                35% 35% at calc(50% + (var(--swing-x) * 0.1%)) calc(50% + (var(--swing-y) * 0.1%)),
                transparent 0%,
                rgba(0, 0, 0, 0.98) 40%
            );
        }

        .info {
            position: relative;
            z-index: 10;
            text-align: center;
            max-width: 800px;
            padding: 2rem;
            margin-top: -2rem;
        }

        .ai-suggestion-box {
            background: rgba(255, 255, 255, 0.05);
            border: 1px dashed rgba(255, 255, 255, 0.2);
            padding: 1.5rem;
            border-radius: 15px;
            margin-bottom: 2rem;
            min-height: 80px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(10px);
        }

        .ai-text {
            font-style: italic;
            color: #a0aec0;
            font-size: 1rem;
        }

        .gemini-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
            padding: 0.8rem 1.5rem;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 1rem auto;
            transition: transform 0.2s;
        }

        .gemini-btn:hover {
            transform: scale(1.05);
        }

        .follow {
            display: inline-block;
            text-decoration: none;
            color: #fff;
            padding: 1rem 2.5rem;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 50px;
            font-size: 0.9rem;
            font-weight: 700;
            letter-spacing: 2px;
            text-transform: uppercase;
            transition: all 0.3s ease;
            background: transparent;
        }

        .follow:hover {
            background: #fff;
            color: #000;
        }

        @keyframes swing {
            0% { --swing-x: -30; --swing-y: -20; }
            100% { --swing-x: 30; --swing-y: 20; }
        }

        .loading-dots:after {
            content: ' .';
            animation: dots 1.5s steps(5, end) infinite;
        }

        @keyframes dots {
            0%, 20% { content: ' .'; }
            40% { content: ' ..'; }
            60% { content: ' ...'; }
            80%, 100% { content: ''; }
        }
    </style>
</head>
<body>

    <h1>
        404
        <span aria-hidden="true">404</span>
    </h1>

    <div class="cloak__wrapper">
        <div class="cloak__container">
            <div class="cloak"></div>
        </div>
    </div>

    <div class="info">
        <div class="ai-suggestion-box">
            <p id="ai-status" class="ai-text">AI is analyzing your location in the void...</p>
            <p id="ai-content" style="display:none; font-weight: 300;"></p>
            <button id="ask-gemini" class="gemini-btn">
                ✨ Ask Gemini why I'm here
            </button>
        </div>
        
        <a class="follow" href="/">Return to Light</a>
    </div>
<script>
    const apiKey = "<%= env.GEMINI_API_KEY %>";

    async function fetchGeminiAdvice() {
        const statusEl = document.getElementById('ai-status');
        const contentEl = document.getElementById('ai-content');
        const btn = document.getElementById('ask-gemini');

        if (!apiKey || apiKey === "undefined" || apiKey === "") {
            statusEl.textContent = "Error: API Key missing in .env";
            return;
        }

        statusEl.innerHTML = "Consulting the Oracle<span class='loading-dots'></span>";
        statusEl.style.display = "block";
        contentEl.style.display = "none";
        btn.disabled = true;

        const currentPath = window.location.pathname;
        
        // ২০২৫ সালের জন্য সবচেয়ে স্থিতিশীল এন্ডপয়েন্ট এবং মডেল
        // এন্ডপয়েন্ট: v1 (Stable), মডেল: gemini-1.5-flash
        const apiUrl = `https://generativelanguage.googleapis.com/v1/models/gemini-1.5-flash:generateContent?key=${apiKey}`;

        try {
            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    contents: [{
                        parts: [{
                            text: `Context: This is a 404 error page. Path: "${currentPath}". 
                            Task: Write a witty and funny 1-sentence explanation of why the user is lost.`
                        }]
                    }]
                })
            });

            const data = await response.json();

            // যদি এরর আসে তবে কনসোলে বিস্তারিত দেখাবে
            if (data.error) {
                console.error("Gemini API Detailed Error:", data.error);
                statusEl.textContent = "The Oracle is having a bad day. (Check console)";
                return;
            }

            const text = data.candidates?.[0]?.content?.parts?.[0]?.text;
            
            if (text) {
                statusEl.style.display = "none";
                contentEl.textContent = text;
                contentEl.style.display = "block";
            } else {
                statusEl.textContent = "The void is silent.";
            }

        } catch (error) {
            console.error("System Error:", error);
            statusEl.textContent = "AI connection failed.";
        } finally {
            btn.disabled = false;
            btn.innerHTML = "✨ Ask for more wisdom";
        }
    }

    document.getElementById('ask-gemini').addEventListener('click', fetchGeminiAdvice);
    window.addEventListener('load', () => setTimeout(fetchGeminiAdvice, 1000));
</script>
</body>
</html>